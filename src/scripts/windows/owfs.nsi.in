# $Id$
# Part of the OWFS (One Wire Filesystem)
# See http://owfs.sourceforge.net
# or http://www.owfs/org
# Copyright 2006 Paul H Alfille
#
# Windows installer script
# Using NSIS from Nullsoft
#
# file src/windows/owfs.nsi

#########
# Version
#########
!ifndef VERSION
  !define VERSION '@VERSION@'
!endif

#########
# directories -- up from src/windows/scripts
#########
!define ROOT_OWFS "..\..\.."
!define ROOT_MODULE "${ROOT_OWFS}\module"
!define ROOT_HOME "${ROOT_OWFS}\..\.."
!define ROOT_CYGWIN "${ROOT_HOME}\.."

#########
# Name
#########
Name "OWFS"
Caption "OWFS (One Wire Filesystem) ${VERSION} Setup"

#########
# Location
#########
# The default installation directory
InstallDir $PROGRAMFILES\OWFS
# Result
!ifdef OUTFILE
  OutFile "${OUTFILE}"
!else
  OutFile ${ROOT_OWFS}\owfs_${VERSION}.exe
!endif

#########
# Install settings
#########
SetCompressor /SOLID lzma
SetOverwrite ifnewer
CRCCheck on

InstType "Programs"
InstType "Source"

#########
# License
#########
LicenseData "${ROOT_OWFS}\COPYING"

#########
# Pages
#########
Page license
Page components
Page directory
Page instfiles
UninstPage uninstConfirm
UninstPage instfiles

#########
# Files
#########
Section "OWFS program files" Bins

  SetDetailsPrint textonly
  DetailPrint "Installing OWFS Program Files..."
  SetDetailsPrint listonly

  SectionIn 1 2 RO
  SetOutPath $INSTDIR
  MessageBox MB_OK Fversion
  File "${ROOT_MODULE}\owshell\src\c\owdir.exe"
  File "${ROOT_MODULE}\owshell\src\c\owread.exe"
  File "${ROOT_MODULE}\owshell\src\c\owwrite.exe"
  File "${ROOT_MODULE}\owshell\src\c\owpresent.exe"
  File "${ROOT_MODULE}\owshell\src\c\owdir.exe"
  File "${ROOT_MODULE}\owhttpd\src\c\owhttpd.exe"
  File "${ROOT_MODULE}\owserver\src\c\owserver.exe"
  File "${ROOT_MODULE}\owftpd\src\c\owftpd.exe"
  File "${ROOT_CYGWIN}\bin\cygwin1.dll"

SectionEnd

Section "OWFS source files" Source

  SetDetailsPrint textonly
  DetailPrint "Installing OWFS Source Files..."
  SetDetailsPrint listonly

  SectionIn 2
  SetOutPath $INSTDIR\source
  File /r "${ROOT_OWFS}\*.c"
  File /r "${ROOT_OWFS}\*.h"
  File /r "${ROOT_OWFS}\*.am"

  SetOutPath $INSTDIR\source\src\man
  File /r "${ROOT_OWFS}\src\man\*"

SectionEnd
